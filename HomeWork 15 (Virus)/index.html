<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HomeWork 15 (Virus)</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="wrap">
  <div id="timer" class="timer">00:01:00</div>
  <div id="speed" class="speed">Speed: x1</div>
  <div id="score" class="score">0 Points</div>
    <div id="v0" class="block p1"></div>
    <div id="v1" class="block p2"></div>
    <div id="v2" class="block p3"></div>
    <div id="v3" class="block p4"></div>
    <div id="v4" class="block p5"></div>
    <div id="v5" class="block p6"></div>
    <div id="v6" class="block p7"></div>
    <div id="v7" class="block p8"></div>
    <div id="v8" class="block p9"></div>
    <div id="v9" class="block p10"></div>
    <div class="base">
      <div class="cell b1"></div>
      <div class="cell b2"></div>
      <div class="cell b3"></div>
      <div class="cell b4"></div>
      <div class="cell b5"></div>
      <div class="cell b6"></div>
      <div class="cell b7"></div>
      <div class="cell b8"></div>
      <div class="cell b9"></div>
      <div class="cell b10"></div>
      <div class="cell b11"></div>
      <div class="cell b12"></div>
      <div class="cell b13"></div>
      <div class="cell b14"></div>
      <div class="cell b15"></div>
    </div>
</div>

<script>


var game = true; //играем?
var points = 0;
var speed = 0;

//Рандом выбирает вируса
function random(max) {
  return Math.floor(Math.random() * max);
}

function startTimer() {
  var timer = document.getElementById("timer");
  var time = timer.innerHTML;
  var arr = time.split(":");
  var h = arr[0];
  var m = arr[1];
  s = arr[2];
  if (s == 0) {
    if (m == 0) {
      if (h == 0) {
        game = false;
        alert("Вы победили! Так держать! Теперь убейте последнего вируса!");
        clearInterval(timerV);
        return;
      }
      h--;
      m = 60;
      if (h < 10) h = "0" + h;
    }
    m--;
    if (m < 10) m = "0" + m;
     s = 59;
  }
  else s--;
  if (s < 10) s = "0" + s;
  document.getElementById("timer").innerHTML = h+":"+m+":"+s;
  xTimer = setTimeout(startTimer, 1000);
  }

startTimer(); //запускаем таймер
launch(); //запускаем вирус


function launch() {
  if (game == true) {
    if (s >= 40) {
      speed = 1;
      document.getElementById("speed").innerHTML = 'Speed: x1';
    }
    else if (s < 40 && s > 20 ) {
      speed = 2;
      document.getElementById("speed").innerHTML = 'Speed: x2';
    }
    else {
      speed = 3;
      document.getElementById("speed").innerHTML = 'Speed: x3';
    }

    var virus = 'v'+random(9); //Создаем переменную STRING с рандомным вирусом
    var vir = eval('(' +virus+ ')'); //Переводим переменную STRING с рандомным вирусом в объект
    var start = Date.now();
    
    timerV = setInterval(function() {
      var timePassed = Date.now() - start;

      if (speed == 1) {
        vir.style.top = timePassed / 5 + 'px';   
        if (timePassed > 3400) {
          clearInterval(timerV);
          clearTimeout(xTimer);
          alert('Вы проиграли! Ваш счет: ' +points+' Points!');
          game = false;
        }
      }

      if (speed == 2) {

          vir.style.top = timePassed / 4 + 'px';
          if (timePassed > 2700) {
            clearInterval(timerV);
            clearTimeout(xTimer);
            alert('Вы проиграли! Ваш счет: ' +points+' Points!');
            game = false;
          }
      }
      if (speed == 3) {

          vir.style.top = timePassed / 3 + 'px';
          if (timePassed > 2000) {
            clearInterval(timerV);
            clearTimeout(xTimer);
            alert('Вы проиграли! Ваш счет: ' +points+' Points!');
            game = false;
          }

      }

    }, 20);
  } else {
    alert('Игра окончена! Ваш счет: ' +points+' Points!');
  }
}
v0.onclick = function() {
  clearInterval(timerV);
  v0.style.top = '-10%';
  points = points + 50;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v1.onclick = function() {
  clearInterval(timerV);
  v1.style.top = '-10%';
  points = points + 40;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v2.onclick = function() {
  clearInterval(timerV);
  v2.style.top = '-10%';
  points = points + 50;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v3.onclick = function() {
  clearInterval(timerV);
  v3.style.top = '-10%';
  points = points + 10;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v4.onclick = function() {
  clearInterval(timerV);
  v4.style.top = '-10%';
  points = points + 30;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v5.onclick = function() {
  clearInterval(timerV);
  v5.style.top = '-10%';
  points = points + 40;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v6.onclick = function() {
  clearInterval(timerV);
  v6.style.top = '-10%';
  points = points + 50;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v7.onclick = function() {
  clearInterval(timerV);
  v7.style.top = '-10%';
  points = points + 30;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v8.onclick = function() {
  clearInterval(timerV);
  v8.style.top = '-10%';
  points = points + 10;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}
v9.onclick = function() {
  clearInterval(timerV);
  v9.style.top = '-10%';
  points = points + 40;
  document.getElementById("score").innerHTML = points + ' Points';
  launch();
}

</script>
</body>
</html>